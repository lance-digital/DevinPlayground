# VSCode トークンカウンター拡張機能

ファイルとフォルダのトークン数をサイドバーに表示するVisual Studio Code拡張機能です。LLMを使用する開発者がコードベース全体のトークン使用量を追跡するのに最適です。

## 機能

- **全ファイル対応**: 基本的に全ファイル形式のトークン数を表示（除外設定可能）
- **フォルダ集計**: フォルダ内の全ファイルの累積トークン数を表示
- **全ワークスペーススキャン**: ワークスペース内の全ファイルを自動的にスキャンしてトークン数を表示
- **.gitignore除外**: .gitignoreファイルに記載されたファイルやフォルダを自動的に除外
- **JavaScript互換**: 純粋なJavaScriptによるトークン推定でLLMアプリケーションとの互換性を実現
- **パフォーマンス最適化**: キャッシュとファイルサイズ制限により応答性を維持
- **設定可能**: 除外するファイル形式と最大ファイルサイズをカスタマイズ可能

## 対応ファイル形式

**基本的に全ファイル形式を処理します**（除外設定されたもの以外）

デフォルトで除外されるファイル形式：
- 実行ファイル: `.exe`, `.dll`, `.so`, `.dylib`, `.bin`
- オブジェクトファイル: `.obj`, `.o`, `.a`, `.lib`
- アーカイブ: `.zip`, `.tar`, `.gz`, `.rar`, `.7z`
- ドキュメント: `.pdf`, `.doc`, `.docx`, `.xls`, `.xlsx`, `.ppt`, `.pptx`
- 画像: `.jpg`, `.jpeg`, `.png`, `.gif`, `.bmp`, `.svg`, `.ico`
- メディア: `.mp3`, `.mp4`, `.avi`, `.mov`, `.wmv`, `.flv`, `.wav`
- ログファイル: `.log`

上記以外の全ファイル（テキストファイル、コードファイル、設定ファイル等）はトークン数が表示されます。

## 設定

VSCodeの設定で拡張機能の動作をカスタマイズできます：

- `tokenCounter.excludedFileTypes`: トークンカウントから除外するファイル拡張子の配列
- `tokenCounter.maxFileSize`: 処理する最大ファイルサイズ（バイト単位、デフォルト: 1MB）

## 使用方法

1. 拡張機能をインストール
2. **VSCodeを再起動**（重要：拡張機能が正常に動作するために必要）
3. コードファイルを含むワークスペースを開く
4. エクスプローラーパネルに「Files with Token Counts」ビューが表示される
5. ファイルとフォルダ名にトークン数が直接埋め込まれて表示される（例：`sample.js [1.2K]`）
6. 「トークン数を更新」コマンドで手動で全カウントを更新

### .gitignore除外機能

拡張機能は自動的に各ワークスペースフォルダの`.gitignore`ファイルを読み込み、記載されたパターンに一致するファイルやフォルダをトークンカウントから除外します。

- `.gitignore`ファイルが存在する場合、そのパターンが自動的に適用されます
- デフォルトで`node_modules`、`.git`、`dist`、`build`フォルダも除外されます
- コメント行（`#`で始まる行）は無視されます
- フォルダパターン（`/`で終わる）は適切に処理されます

### トラブルシューティング

#### 基本的な解決手順
1. **VSCodeを完全に再起動**してください（重要：拡張機能が正常に動作するために必要）
2. ワークスペースを再読み込みしても表示されない場合：コマンドパレットから「Token Counter: Refresh Token Counts」を実行してください

#### 詳細なデバッグ手順
拡張機能が動作しない場合は、以下の手順でデバッグしてください：

1. **開発者コンソールを開く**
   - メニューから「ヘルプ」→「開発者ツールの切り替え」→「コンソール」タブを選択
   - または `Ctrl+Shift+I` (Windows/Linux) / `Cmd+Option+I` (Mac) でコンソールを開く

2. **拡張機能のログを確認**
   - コンソールで以下のメッセージを探してください：
     - `🚀 Token Counter extension activation started!` - 拡張機能の起動開始
     - `✅ TokenCounterProvider created successfully` - プロバイダーの作成成功
     - `✅ FileDecorationProvider registered` - デコレーションプロバイダーの登録成功
     - `✅ Refresh command registered` - リフレッシュコマンドの登録成功
     - `🎉 Token Counter extension activation completed successfully!` - 起動完了

3. **エラーメッセージの確認**
   - `❌` や `💥 FATAL` で始まるエラーメッセージがないか確認
   - tiktoken初期化エラーの場合、フォールバック機能が動作します

4. **手動リフレッシュのテスト**
   - コマンドパレット（`Ctrl+Shift+P` / `Cmd+Shift+P`）を開く
   - 「Token Counter: Refresh Token Counts」と入力して実行
   - 成功メッセージまたはエラーメッセージを確認

5. **ファイル処理の確認**
   - コンソールで `🎯 Providing decoration for:` メッセージを確認
   - 対応ファイル形式（.js, .py, .md等）のファイルが処理されているか確認

#### よくある問題と解決策
- **コマンドが見つからない**: 拡張機能が正しく起動していません。VSCodeを再起動してください
- **トークン数が0と表示される**: ファイル形式が対応していないか、ファイルサイズが制限を超えています
- **tiktoken エラー**: フォールバック機能により単語数ベースの概算値が使用されます

## コマンド

- `Token Counter: Refresh Token Counts` - 全トークン数を手動更新してキャッシュをクリア

## 動作原理

この拡張機能はVSCodeのFileSystemProvider APIとTreeDataProvider APIを使用して、カスタムファイルエクスプローラービューを作成し、ファイル名とフォルダ名にトークン数を直接埋め込んで表示します。トークン数は純粋なJavaScriptによる推定計算を使用し、LLMアプリケーションとの互換性を実現します。

## 開発

拡張機能をビルドしてテストするには：

```bash
npm install
npm run compile
```

拡張機能をパッケージするには：

```bash
npx vsce package
```
